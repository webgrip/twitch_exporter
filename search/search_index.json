{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Twitch Exporter","text":"<p>Prometheus exporter that collects Twitch channel metrics via:</p> <ul> <li>Helix polling (bounded-label metrics suitable for long-term storage)</li> <li>EventSub webhook (self-only, privileged metrics; requires a public webhook)</li> </ul>","tags":["twitch","prometheus","exporter"],"boost":5},{"location":"#where-to-start","title":"Where to start","text":"<ul> <li>New here? Read Quickstart</li> <li>Deploying? Read Docker deployment</li> <li>Looking for what to scrape? Read Metrics</li> <li>Enabling deep self metrics? Read EventSub</li> </ul>","tags":["twitch","prometheus","exporter"],"boost":5},{"location":"configuration/","title":"Configuration","text":"<p>The exporter is configured primarily via flags (Kingpin). For container usage, you typically map environment variables into those flags.</p>"},{"location":"configuration/#required","title":"Required","text":""},{"location":"configuration/#helix-app-credentials","title":"Helix app credentials","text":"<ul> <li><code>--twitch.client-id</code> (required)</li> <li><code>--twitch.client-secret</code> (recommended)</li> </ul> <p>If <code>--twitch.client-secret</code> is missing, the exporter will still start, but it disables default collectors and exports <code>twitch_exporter_configured 0</code>.</p>"},{"location":"configuration/#channels","title":"Channels","text":""},{"location":"configuration/#preferred-flags","title":"Preferred flags","text":"<ul> <li><code>--twitch.self-channel=&lt;login&gt;</code></li> <li><code>--twitch.watch-channel=&lt;login&gt;</code> (repeatable, max 100)</li> </ul>"},{"location":"configuration/#legacy-flag","title":"Legacy flag","text":"<ul> <li><code>--twitch.channel=&lt;login&gt;</code> (deprecated)</li> </ul> <p>Back-compat behavior:</p> <ul> <li>If <code>--twitch.self-channel</code> is not set and you pass one or more <code>--twitch.channel</code>, the first legacy channel is treated as <code>role=self</code>.</li> </ul>"},{"location":"configuration/#web-server","title":"Web server","text":"<ul> <li><code>--web.listen-address</code> (default provided by exporter-toolkit flags)</li> <li><code>--web.telemetry-path</code> (default <code>/metrics</code>)</li> </ul> <p>The exporter uses Prometheus exporter-toolkit, so you can also use the toolkit\u2019s <code>--web.config.file</code> to enable TLS and/or basic auth.</p>"},{"location":"configuration/#eventsub-optional","title":"EventSub (optional)","text":"<p>EventSub is off by default.</p> <ul> <li><code>--eventsub.enabled</code></li> <li><code>--eventsub.webhook-url=https://&lt;public-host&gt;/eventsub</code> (must end with <code>/eventsub</code>)</li> <li><code>--eventsub.webhook-secret=&lt;secret&gt;</code></li> </ul> <p>Important Twitch constraints:</p> <ul> <li>Webhook callback must be reachable via HTTPS on port 443 for real subscriptions.</li> <li>Secret should be ASCII 10\u2013100 chars (Twitch requirement).</li> </ul>"},{"location":"configuration/#reward-grouping-bounded-labels","title":"Reward grouping (bounded labels)","text":"<p>To keep <code>reward_group</code> bounded for channel point redemptions:</p> <ul> <li><code>--twitch.reward-group.default=default</code></li> <li><code>--twitch.reward-group.unknown=other</code></li> <li><code>--twitch.reward-group.max=20</code></li> <li><code>--twitch.reward-group.id=&lt;reward_id&gt;:&lt;group&gt;</code> (repeatable)</li> <li><code>--twitch.reward-group.title=&lt;reward_title&gt;:&lt;group&gt;</code> (repeatable; title is normalized to lowercase)</li> </ul> <p>If the number of unique groups exceeds <code>--twitch.reward-group.max</code>, the exporter exits with an error.</p>"},{"location":"development/","title":"Development","text":""},{"location":"development/#repo-layout","title":"Repo layout","text":"<ul> <li><code>src/</code> contains the Go module</li> <li><code>src/collector/</code> contains collectors and metric definitions</li> <li><code>src/internal/eventsub/</code> contains EventSub webhook plumbing</li> </ul>"},{"location":"development/#common-tasks","title":"Common tasks","text":"<ul> <li>Build: <code>make</code></li> <li>Format: <code>make common-format</code></li> <li>Lint: <code>make common-lint</code></li> <li>Test: <code>make common-test</code></li> </ul>"},{"location":"development/#adding-a-collector","title":"Adding a collector","text":"<p>Collectors are registered via <code>registerCollector</code> with a default enabled/disabled state.</p> <p>Guidelines:</p> <ul> <li>Keep labels bounded</li> <li>Prefer <code>role</code> and stable identifiers over names that change frequently</li> <li>If an API surface requires user scopes, export a clear disabled reason via <code>twitch_collector_disabled_total{...}</code></li> </ul>"},{"location":"eventsub/","title":"EventSub","text":"<p>EventSub support is disabled by default because it requires exposing a webhook endpoint.</p>"},{"location":"eventsub/#what-it-does","title":"What it does","text":"<p>When enabled, the exporter:</p> <ul> <li>Serves an HTTP handler at <code>POST /eventsub</code></li> <li>Verifies the Twitch signature using HMAC-SHA256</li> <li>Registers EventSub subscriptions (webhook transport)</li> <li>Updates self-only metrics as notifications arrive</li> </ul>"},{"location":"eventsub/#requirements","title":"Requirements","text":""},{"location":"eventsub/#public-webhook","title":"Public webhook","text":"<p>For real Twitch subscriptions, your callback must be:</p> <ul> <li>HTTPS</li> <li>Port 443</li> <li>Publicly reachable</li> </ul> <p>For local testing, the Twitch CLI can send verification/notification events without requiring public HTTPS.</p>"},{"location":"eventsub/#secrets","title":"Secrets","text":"<p>Twitch requires a webhook secret that is:</p> <ul> <li>ASCII</li> <li>10\u2013100 characters</li> </ul> <p>The exporter uses the webhook secret to verify <code>Twitch-Eventsub-Message-Signature</code>.</p>"},{"location":"eventsub/#enabling","title":"Enabling","text":"<p>Minimum flags:</p> <ul> <li><code>--eventsub.enabled</code></li> <li><code>--eventsub.webhook-url=https://&lt;public-host&gt;/eventsub</code></li> <li><code>--eventsub.webhook-secret=&lt;secret&gt;</code></li> <li><code>--collector.eventsub_self</code></li> <li><code>--twitch.self-channel=&lt;login&gt;</code></li> </ul> <p>For privileged topics, you also need a user token + refresh token and the appropriate scopes.</p>"},{"location":"eventsub/#signature-verification","title":"Signature verification","text":"<p>Twitch signs each message with:</p> <ul> <li><code>message = &lt;msg_id&gt; + &lt;timestamp&gt; + &lt;raw_body&gt;</code></li> <li><code>hmac = HMAC_SHA256(secret, message)</code></li> <li>header: <code>Twitch-Eventsub-Message-Signature: sha256=&lt;hex&gt;</code></li> </ul> <p>If verification fails, the exporter returns <code>403</code> and increments <code>twitch_eventsub_signature_fail_total{reason=...}</code>.</p>"},{"location":"eventsub/#testing","title":"Testing","text":"<p>Using Twitch CLI (recommended for local):</p> <ul> <li>Send a verification challenge</li> <li>Trigger a sample event</li> </ul> <p>See Twitch docs for the exact CLI commands and supported triggers.</p>"},{"location":"metrics/","title":"Metrics","text":"<p>This exporter provides two classes of metrics:</p> <ul> <li>Recommended (bounded labels): designed for long-term Prometheus storage</li> <li>Legacy (high-cardinality labels): disabled by default, kept for compatibility</li> </ul> <p>The application namespace is <code>twitch_</code>.</p>"},{"location":"metrics/#recommended-bounded-labels","title":"Recommended (bounded labels)","text":""},{"location":"metrics/#channel-state-helix-polling","title":"Channel state (Helix polling)","text":"<p>Labels are bounded to <code>channel</code> and <code>role</code>.</p> <ul> <li><code>twitch_channel_live{channel,role}</code> (gauge 1/0)</li> <li><code>twitch_channel_viewers{channel,role}</code> (gauge)</li> <li><code>twitch_channel_stream_started_at_seconds{channel,role}</code> (gauge unix timestamp)</li> <li><code>twitch_channel_stream_uptime_seconds{channel,role}</code> (gauge)</li> <li><code>twitch_channel_category_id{channel,role}</code> (gauge)</li> <li><code>twitch_channel_title_change_total{channel,role}</code> (counter)</li> <li><code>twitch_channel_category_change_total{channel,role}</code> (counter)</li> <li><code>twitch_channel_stream_starts_total{channel,role}</code> (counter)</li> <li><code>twitch_channel_stream_ends_total{channel,role}</code> (counter)</li> </ul>"},{"location":"metrics/#eventsub-self-only-optional","title":"EventSub self-only (optional)","text":"<p>Disabled by default; see EventSub.</p> <ul> <li><code>twitch_eventsub_notifications_total{channel,role,event_type}</code></li> <li><code>twitch_eventsub_subscription_desired{event_type}</code></li> <li><code>twitch_eventsub_subscription_active{event_type}</code></li> <li><code>twitch_channel_follows_total{channel}</code></li> <li><code>twitch_channel_subscriptions_total{channel,kind}</code></li> <li><code>twitch_channel_gift_subscriptions_total{channel}</code></li> <li><code>twitch_channel_bits_total{channel}</code></li> <li><code>twitch_channel_bits_events_total{channel}</code></li> <li><code>twitch_channel_points_redemptions_total{channel,reward_group}</code></li> <li><code>twitch_channel_raids_in_total{channel}</code></li> <li><code>twitch_channel_raids_out_total{channel}</code></li> <li><code>twitch_ads_ad_breaks_total{channel}</code></li> <li><code>twitch_ads_minutes_total{channel}</code></li> <li><code>twitch_hype_train_events_total{channel,stage}</code></li> <li><code>twitch_goals_events_total{channel,stage}</code></li> <li><code>twitch_polls_events_total{channel,stage}</code></li> <li><code>twitch_predictions_events_total{channel,stage}</code></li> <li><code>twitch_charity_events_total{channel,stage}</code></li> <li><code>twitch_moderation_actions_total{channel,action}</code></li> </ul>"},{"location":"metrics/#runtimeinstrumentation","title":"Runtime/instrumentation","text":"<ul> <li><code>twitch_exporter_configured</code> (gauge)</li> <li><code>twitch_oauth_token_present{token_type=\"app|user\"}</code> (gauge)</li> <li><code>twitch_oauth_scope_present{scope}</code> (gauge; bounded to known scopes)</li> <li><code>twitch_api_requests_total{api,endpoint,code_class}</code> (counter)</li> <li><code>twitch_api_rate_limit_remaining{api}</code> (gauge)</li> <li><code>twitch_api_rate_limit_reset_at_seconds{api}</code> (gauge)</li> <li><code>twitch_collector_last_success_timestamp_seconds{collector}</code> (gauge)</li> <li><code>twitch_collector_errors_total{collector,reason}</code> (counter)</li> <li><code>twitch_collector_disabled_total{collector,reason}</code> (counter)</li> <li><code>twitch_eventsub_signature_fail_total{reason}</code> (counter)</li> </ul>"},{"location":"metrics/#legacy-high-cardinality","title":"Legacy (high-cardinality)","text":"<p>These are disabled by default due to unbounded label sets such as <code>game</code> and <code>chatter_username</code>.</p> <ul> <li><code>twitch_channel_up{username,game}</code></li> <li><code>twitch_channel_viewers_total{username,game}</code></li> <li><code>twitch_channel_views_total{username}</code></li> <li><code>twitch_channel_followers_total{username}</code></li> <li><code>twitch_channel_subscribers_total{username,tier,gifted}</code></li> <li><code>twitch_channel_chat_messages_total{username,chatter_username}</code></li> </ul>"},{"location":"metrics/#cardinality-guidance","title":"Cardinality guidance","text":"<p>Prometheus label values create new time series. Avoid enabling legacy collectors unless you have a short retention period or are scraping into a separate, constrained Prometheus.</p>"},{"location":"project-overview/","title":"Project overview","text":"<p>This exporter exposes Prometheus metrics under a configurable HTTP path (default: <code>/metrics</code>).</p>"},{"location":"project-overview/#data-sources","title":"Data sources","text":""},{"location":"project-overview/#helix-polling-default","title":"Helix polling (default)","text":"<p>Uses the Twitch Helix API to poll channel state periodically during scrapes.</p> <ul> <li>Designed to keep label cardinality bounded (e.g., <code>channel</code>, <code>role</code>)</li> <li>Suitable for long-term retention and remote_write</li> </ul>"},{"location":"project-overview/#eventsub-webhook-optional","title":"EventSub webhook (optional)","text":"<p>Optionally exposes an <code>/eventsub</code> webhook handler and subscribes to EventSub topics.</p> <ul> <li>Intended for self channel only (privileged metrics)</li> <li>Requires a publicly reachable HTTPS endpoint (Twitch requirement)</li> <li>Requires an app access token for webhook subscriptions; some topics also require your app to have user-granted scopes</li> </ul>"},{"location":"project-overview/#watchlist-roles","title":"Watchlist roles","text":"<p>Channels are tracked with a <code>role</code> label:</p> <ul> <li><code>role=self</code> \u2014 your own channel (required for EventSub/self-only collectors)</li> <li><code>role=watch</code> \u2014 channels you\u2019re monitoring in a bounded watch list</li> </ul> <p>The watch list is bounded to max 100 watch channels.</p>"},{"location":"quickstart/","title":"Quickstart","text":""},{"location":"quickstart/#local-docker-compose","title":"Local (Docker Compose)","text":"<ol> <li> <p>Copy example env file:</p> <ul> <li><code>cp .env.example .env</code></li> </ul> </li> <li> <p>Edit <code>.env</code> and set at least:</p> <ul> <li><code>TWITCH_CLIENT_ID</code></li> <li><code>TWITCH_CLIENT_SECRET</code></li> </ul> </li> <li> <p>Start:</p> <ul> <li><code>docker compose up --build</code></li> </ul> </li> <li> <p>Verify:</p> <ul> <li>Open <code>http://localhost:9184/metrics</code></li> <li>Ensure <code>twitch_exporter_configured</code> is <code>1</code></li> </ul> </li> </ol>"},{"location":"quickstart/#local-go","title":"Local (Go)","text":"<ol> <li> <p>Build:</p> <ul> <li><code>make</code></li> </ul> </li> <li> <p>Run:</p> <ul> <li><code>./twitch_exporter --help</code></li> </ul> </li> <li> <p>Start with app credentials and a channel:</p> <ul> <li><code>./twitch_exporter --twitch.client-id ... --twitch.client-secret ... --twitch.self-channel &lt;login&gt;</code></li> </ul> </li> </ol>"},{"location":"quickstart/#next","title":"Next","text":"<ul> <li>See Configuration</li> <li>See Metrics</li> </ul>"},{"location":"security/","title":"Security","text":""},{"location":"security/#secrets-handling","title":"Secrets handling","text":"<p>Treat these values as secrets:</p> <ul> <li>Twitch client secret</li> <li>User access token</li> <li>User refresh token</li> <li>EventSub webhook secret</li> </ul> <p>Do not log them, do not bake them into images.</p>"},{"location":"security/#endpoint-exposure","title":"Endpoint exposure","text":"<p>Expose <code>/metrics</code> only to Prometheus (or an internal network).</p> <p>If you enable EventSub:</p> <ul> <li>You must expose <code>POST /eventsub</code> publicly</li> <li>Prefer running a dedicated exporter instance for EventSub and keep the \u201cwatch\u201d exporters private</li> </ul>"},{"location":"security/#tls-authentication","title":"TLS / authentication","text":"<p>The exporter uses Prometheus exporter-toolkit. Use <code>--web.config.file</code> to enable:</p> <ul> <li>TLS</li> <li>Basic auth</li> </ul>"},{"location":"security/#supply-chain","title":"Supply chain","text":"<p>The container image builds a static Go binary and runs it in a distroless nonroot base image.</p>"},{"location":"deployment/docker/","title":"Deployment: Docker","text":""},{"location":"deployment/docker/#using-the-published-image","title":"Using the published image","text":"<p>The upstream README documents <code>webgrip/twitch-exporter</code> on Docker Hub.</p> <p>Typical options:</p> <ul> <li>Pass flags as container args</li> <li>Provide secrets via environment variables or secret stores</li> <li>Expose port 9184</li> </ul>"},{"location":"deployment/docker/#using-docker-compose-this-repo","title":"Using Docker Compose (this repo)","text":"<p>This repo ships a <code>docker-compose.yml</code> for local development.</p> <ol> <li>Copy <code>.env.example</code> to <code>.env</code></li> <li>Set <code>TWITCH_CLIENT_ID</code> and <code>TWITCH_CLIENT_SECRET</code></li> <li>Run <code>docker compose up --build</code></li> </ol>"},{"location":"deployment/docker/#hardening","title":"Hardening","text":"<p>For production, strongly consider:</p> <ul> <li>Enabling TLS and/or basic auth via <code>--web.config.file</code> (exporter-toolkit)</li> <li>Restricting ingress to Prometheus only</li> <li>Running a separate instance for EventSub self-only metrics (so only that instance is publicly exposed)</li> </ul>"},{"location":"deployment/kubernetes/","title":"Deployment: Kubernetes","text":"<p>This repository does not ship a Helm chart.</p> <p>Use a generic chart (or plain manifests) and configure:</p> <ul> <li>Container args to match flags in Configuration</li> <li>Service port <code>9184</code></li> <li>Prometheus scrape config for <code>/metrics</code></li> </ul>"},{"location":"deployment/kubernetes/#eventsub-in-kubernetes","title":"EventSub in Kubernetes","text":"<p>If enabling EventSub:</p> <ul> <li>Ingress must expose <code>POST /eventsub</code> publicly over HTTPS</li> <li>Ensure the ingress/controller preserves Twitch headers</li> <li>Avoid body transformations (signature verification requires raw body)</li> </ul>"},{"location":"operations/troubleshooting/","title":"Troubleshooting","text":""},{"location":"operations/troubleshooting/#exporter-starts-but-shows-no-twitch-data","title":"Exporter starts but shows no Twitch data","text":"<p>Check:</p> <ul> <li><code>twitch_exporter_configured</code> is <code>1</code></li> <li>Logs for \u201ccollectors are disabled\u201d</li> </ul> <p>Common causes:</p> <ul> <li>Missing <code>--twitch.client-secret</code> (or missing env var backing it)</li> <li>Invalid credentials or revoked tokens</li> </ul>"},{"location":"operations/troubleshooting/#some-collectors-disabled","title":"Some collectors disabled","text":"<p>Check:</p> <ul> <li><code>twitch_collector_disabled_total{collector,reason}</code></li> </ul> <p>Common reasons:</p> <ul> <li><code>missing_token</code> / <code>missing_scope</code> for privileged collectors</li> <li>EventSub collectors require <code>--eventsub.enabled</code> and webhook configuration</li> </ul>"},{"location":"operations/troubleshooting/#eventsub-webhook-verification-fails","title":"EventSub webhook verification fails","text":"<p>Check:</p> <ul> <li><code>twitch_eventsub_signature_fail_total{reason}</code></li> <li>Ensure your reverse proxy does not modify the request body</li> <li>Ensure you are using the same webhook secret you used for subscription creation</li> </ul>"},{"location":"operations/troubleshooting/#rate-limiting","title":"Rate limiting","text":"<p>Check:</p> <ul> <li><code>twitch_api_requests_total{api,endpoint,code_class}</code></li> <li><code>twitch_api_rate_limit_remaining{api}</code></li> <li><code>twitch_api_rate_limit_reset_at_seconds{api}</code></li> </ul>"},{"location":"operations/runbooks/collectors-disabled/","title":"Runbook: collectors disabled","text":""},{"location":"operations/runbooks/collectors-disabled/#symptoms","title":"Symptoms","text":"<ul> <li>Missing expected metrics</li> <li><code>twitch_scrape_collector_success{collector=\"...\"} == 0</code></li> <li><code>twitch_collector_disabled_total{collector=\"...\"} &gt; 0</code></li> </ul>"},{"location":"operations/runbooks/collectors-disabled/#checks","title":"Checks","text":"<ol> <li> <p>Confirm required credentials:</p> <ul> <li><code>twitch_exporter_configured == 1</code></li> </ul> </li> <li> <p>Confirm watchlist role expectations:</p> <ul> <li>Self-only collectors require a configured <code>role=self</code></li> </ul> </li> <li> <p>If EventSub collector:</p> <ul> <li><code>--eventsub.enabled</code> is set</li> <li>webhook URL ends with <code>/eventsub</code></li> <li>webhook secret matches and is within Twitch constraints (ASCII 10\u2013100 chars)</li> </ul> </li> <li> <p>If scope-gated:</p> <ul> <li>check <code>twitch_oauth_scope_present{scope=\"...\"} == 1</code></li> </ul> </li> </ol>"},{"location":"operations/runbooks/collectors-disabled/#actions","title":"Actions","text":"<ul> <li>Add required token/scopes, restart exporter</li> <li>For EventSub, validate webhook by using Twitch CLI challenge verification</li> </ul>"},{"location":"operations/runbooks/eventsub-verification/","title":"Runbook: EventSub verification failures","text":""},{"location":"operations/runbooks/eventsub-verification/#symptoms","title":"Symptoms","text":"<ul> <li>403 responses on <code>/eventsub</code></li> <li><code>twitch_eventsub_signature_fail_total{reason=\"bad_signature\"}</code> increasing</li> </ul>"},{"location":"operations/runbooks/eventsub-verification/#common-causes","title":"Common causes","text":"<ul> <li>Webhook secret mismatch between exporter and Twitch subscription</li> <li>Reverse proxy modifies request body (compression, JSON parsing/re-encoding, etc.)</li> <li>Missing required Twitch headers forwarded to the exporter</li> </ul>"},{"location":"operations/runbooks/eventsub-verification/#actions","title":"Actions","text":"<ol> <li>Confirm proxy forwards the raw request body unmodified.</li> <li>Confirm proxy preserves these headers:<ul> <li><code>Twitch-Eventsub-Message-Id</code></li> <li><code>Twitch-Eventsub-Message-Timestamp</code></li> <li><code>Twitch-Eventsub-Message-Signature</code></li> </ul> </li> <li>Verify webhook secret matches what was used when creating subscriptions.</li> </ol>"},{"location":"operations/runbooks/rate-limits/","title":"Runbook: Twitch API rate limits","text":""},{"location":"operations/runbooks/rate-limits/#symptoms","title":"Symptoms","text":"<ul> <li>Scrapes failing intermittently</li> <li>Increased <code>twitch_api_requests_total{code_class=\"429\"}</code></li> </ul>"},{"location":"operations/runbooks/rate-limits/#checks","title":"Checks","text":"<ul> <li><code>twitch_api_rate_limit_remaining{api=\"helix\"}</code></li> <li>Exporter logs around collector failures</li> </ul>"},{"location":"operations/runbooks/rate-limits/#actions","title":"Actions","text":"<ul> <li>Reduce scrape frequency</li> <li>Reduce enabled collectors</li> <li>Reduce watched channels (max 100 supported for <code>role=watch</code>)</li> <li>Consider running separate exporters for different use cases (e.g., one per \u201cself\u201d channel)</li> </ul>"}]}